#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative '../lib/przn'

require 'optparse'

options = {}
OptionParser.new do |opts|
  opts.banner = "Usage: przn [options] <presentation.md>"
  opts.on('--export [FORMAT]', 'Export to a format (default: pdf)') { |v|
    if v && v.end_with?('.md')
      ARGV.unshift(v)
      options[:export] = 'pdf'
    else
      options[:export] = v || 'pdf'
    end
  }
  opts.on('-o', '--output FILE', 'Output file path for export') { |v| options[:output] = v }
  opts.on('--theme FILE', 'Theme file (YAML)') { |v| options[:theme] = v }
end.parse!

file = ARGV[0]
unless file
  $stderr.puts "Usage: przn [options] <presentation.md>"
  exit 1
end

theme = options[:theme] ? Przn::Theme.load(options[:theme]) : nil

if options[:export] == 'pdf'
  output = options[:output] || File.basename(file, File.extname(file)) + '.pdf'
  Przn.export_pdf(file, output, theme: theme)
else
  Przn.start(file, theme: theme).run
end
